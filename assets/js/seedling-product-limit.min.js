document.addEventListener("DOMContentLoaded",function(){const e=seedlingProductSettings.minQty,t=seedlingProductSettings.slug,n=seedlingProductSettings.step||1,o=document.body,r=document.querySelector("form.variations_form");function i(){return document.querySelector('input[name="variation_id"]')}if(!r)return;if(!o.classList.contains(`product_cat-${t}`))return;function c(){return document.querySelector("input.qty")}let s=1,a=null;function u(){const e=c();e&&(e.removeEventListener("input",d),e.addEventListener("input",d),e.step=n);const t=document.querySelector(".quantity .minus");a&&a!==t&&a.removeEventListener("click",l),t&&(t.removeEventListener("click",l),t.addEventListener("click",l),a=t)}function d(){const e=c();if(!e)return;let t=parseInt(e.value||"0");t<s&&(t=s),t%n!==0&&(t=Math.ceil(t/n)*n),e.value=t,m()}function l(){setTimeout(()=>{const e=c();if(!e)return;let t=parseInt(e.value||"0");t<s&&(t=s),t%n!==0&&(t=Math.ceil(t/n)*n),e.value=t,m()},100)}function m(){if(!a)return;const e=c();if(!e)return;parseInt(e.value||"0")-n<s?(a.disabled=!0,a.classList.add("disabled"),a.setAttribute("aria-disabled","true")):(a.disabled=!1,a.classList.remove("disabled"),a.removeAttribute("aria-disabled"))}function f(e){const t=c();t&&(t.value=e,t.min=e,t.step=n,t.dispatchEvent(new Event("change",{bubbles:!0})))}function v(){const t=i(),n=parseInt(t?.value||"0");if(!n)return s=e,f(s),u(),void m();const o=`${seedlingProductSettings.ajaxUrl}?action=seedling_get_cart_qty&variation_id=${n}&nonce=${seedlingProductSettings.nonce}`;fetch(o,{credentials:"same-origin"}).then(e=>e.json()).then(t=>{if(!t.success)return;const n=t.data.quantity||0;s=Math.max(e-n,1),f(s),u(),m()}).catch(()=>{const e=document.querySelector(".single_add_to_cart_button");e&&(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("aria-disabled","true")),function(e){let t=document.querySelector(".woocommerce-notices-wrapper");if(!t){t=document.createElement("div"),t.className="woocommerce-notices-wrapper";const e=document.querySelector("form.cart");e?e.prepend(t):document.body.prepend(t)}t.innerHTML=`<ul class="woocommerce-error"><li>${e}</li></ul>`}("Не удалось проверить минимальное количество")})}jQuery(function(e){e(r).on("woocommerce_variation_select_change",function(){setTimeout(v,100)}),e(r).on("found_variation",function(e,t){const n=t?.variation_id;if(!n)return;const o=i();o&&(o.value=n),setTimeout(v,0)}),e(r).on("show_variation",function(){setTimeout(v,0)})}),setTimeout(v,0),jQuery(function(e){e(document.body).on("click",".single_add_to_cart_button",function(){let t=!1;e(document.body).one("added_to_cart",function(){t=!0}),setTimeout(()=>{t||e.get("/?wc-ajax=get_refreshed_fragments",function(t){if(t&&t.fragments&&t.fragments["div.woocommerce-error"]){const n=e(".woocommerce-notices-wrapper, .mfn-ch-content, .cart-empty");n.length?n.first().html(t.fragments["div.woocommerce-error"]):e("form.cart").before(t.fragments["div.woocommerce-error"])}})},1200)})})});