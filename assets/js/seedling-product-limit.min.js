document.addEventListener("DOMContentLoaded",function(){const e=seedlingProductSettings.minQty,t=seedlingProductSettings.slug,n=document.body,o=document.querySelector("form.variations_form");function i(){return document.querySelector('input[name="variation_id"]')}if(!o)return;if(!n.classList.contains(`product_cat-${t}`))return;function r(){return document.querySelector("input.qty")}let c=1,s=null;function a(){const e=r();e&&(e.removeEventListener("input",u),e.addEventListener("input",u));const t=document.querySelector(".quantity .minus");s&&s!==t&&s.removeEventListener("click",d),t&&(t.removeEventListener("click",d),t.addEventListener("click",d),s=t)}function u(){const e=r();e&&(parseInt(e.value||"0")<c&&(e.value=c),l())}function d(){setTimeout(()=>{const e=r();e&&(parseInt(e.value||"0")<c&&(e.value=c),l())},100)}function l(){if(!s)return;const e=r();if(!e)return;parseInt(e.value||"0")<=c?(s.disabled=!0,s.classList.add("disabled"),s.setAttribute("aria-disabled","true")):(s.disabled=!1,s.classList.remove("disabled"),s.removeAttribute("aria-disabled"))}function m(e){const t=r();t&&(t.value=e,t.min=e,t.dispatchEvent(new Event("change",{bubbles:!0})))}function f(){const t=i(),n=parseInt(t?.value||"0");if(!n)return c=e,m(c),a(),void l();const o=`${seedlingProductSettings.ajaxUrl}?action=seedling_get_cart_qty&variation_id=${n}&nonce=${seedlingProductSettings.nonce}`;fetch(o,{credentials:"same-origin"}).then(e=>e.json()).then(t=>{if(!t.success)return;const n=t.data.quantity||0;c=Math.max(e-n,1),m(c),a(),l()}).catch(()=>{const e=document.querySelector(".single_add_to_cart_button");e&&(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("aria-disabled","true")),console.error("Не удалось получить минимальное количество")})}jQuery(function(e){e(o).on("woocommerce_variation_select_change",function(){setTimeout(f,100)}),e(o).on("found_variation",function(e,t){const n=t?.variation_id;if(!n)return;const o=i();o&&(o.value=n),setTimeout(f,0)}),e(o).on("show_variation",function(){setTimeout(f,0)})}),setTimeout(f,0),jQuery(function(e){e(document.body).on("click",".single_add_to_cart_button",function(){let t=!1;e(document.body).one("added_to_cart",function(){t=!0}),setTimeout(()=>{t||e.get("/?wc-ajax=get_refreshed_fragments",function(t){if(t&&t.fragments&&t.fragments["div.woocommerce-error"]){const n=e(".woocommerce-notices-wrapper, .mfn-ch-content, .cart-empty");n.length?n.first().html(t.fragments["div.woocommerce-error"]):e("form.cart").before(t.fragments["div.woocommerce-error"])}})},1200)})})});