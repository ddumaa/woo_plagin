document.addEventListener("DOMContentLoaded",function(){const e=seedlingProductSettings.rule||{},t=e.minQty,n=e.slug,o=e.step||1,r=document.body,i=document.querySelector("form.variations_form");function c(){return document.querySelector('input[name="variation_id"]')}if(!i)return;if(!r.classList.contains(`product_cat-${n}`))return;function a(){return document.querySelector("input.qty")}let s=1,u=null;function d(){const e=a();e&&(e.removeEventListener("input",l),e.addEventListener("input",l),e.step=o);const t=document.querySelector(".quantity .minus");u&&u!==t&&u.removeEventListener("click",m),t&&(t.removeEventListener("click",m),t.addEventListener("click",m),u=t)}function l(){const e=a();if(!e)return;let t=parseInt(e.value||"0");t<s&&(t=s),t%o!==0&&(t=Math.ceil(t/o)*o),e.value=t,f()}function m(){setTimeout(()=>{const e=a();if(!e)return;let t=parseInt(e.value||"0");t<s&&(t=s),t%o!==0&&(t=Math.ceil(t/o)*o),e.value=t,f()},100)}function f(){if(!u)return;const e=a();if(!e)return;parseInt(e.value||"0")-o<s?(u.disabled=!0,u.classList.add("disabled"),u.setAttribute("aria-disabled","true")):(u.disabled=!1,u.classList.remove("disabled"),u.removeAttribute("aria-disabled"))}function v(e){const t=a();t&&(t.value=e,t.min=e,t.step=o,t.dispatchEvent(new Event("change",{bubbles:!0})))}function _(){const e=c(),n=parseInt(e?.value||"0");if(!n)return s=t,v(s),d(),void f();const o=`${seedlingProductSettings.ajaxUrl}?action=seedling_get_cart_qty&variation_id=${n}&nonce=${seedlingProductSettings.nonce}`;fetch(o,{credentials:"same-origin"}).then(e=>e.json()).then(e=>{if(!e.success)return;const n=e.data.quantity||0;s=Math.max(t-n,1),v(s),d(),f()}).catch(()=>{const e=document.querySelector(".single_add_to_cart_button");e&&(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("aria-disabled","true")),function(e){let t=document.querySelector(".woocommerce-notices-wrapper");if(!t){t=document.createElement("div"),t.className="woocommerce-notices-wrapper";const e=document.querySelector("form.cart");e?e.prepend(t):document.body.prepend(t)}t.innerHTML=`<ul class="woocommerce-error"><li>${e}</li></ul>`}("Не удалось проверить минимальное количество")})}jQuery(function(e){e(i).on("woocommerce_variation_select_change",function(){setTimeout(_,100)}),e(i).on("found_variation",function(e,t){const n=t?.variation_id;if(!n)return;const o=c();o&&(o.value=n),setTimeout(_,0)}),e(i).on("show_variation",function(){setTimeout(_,0)})}),setTimeout(_,0),jQuery(function(e){e(document.body).on("click",".single_add_to_cart_button",function(){let t=!1;e(document.body).one("added_to_cart",function(){t=!0}),setTimeout(()=>{t||e.get("/?wc-ajax=get_refreshed_fragments",function(t){if(t&&t.fragments&&t.fragments["div.woocommerce-error"]){const n=e(".woocommerce-notices-wrapper, .mfn-ch-content, .cart-empty");n.length?n.first().html(t.fragments["div.woocommerce-error"]):e("form.cart").before(t.fragments["div.woocommerce-error"])}})},1200)})})});